# See paper for experiment description

default_model: &default_params
  gbr_model:
    n_estimators: 150
    max_depth: 3
    criterion: 'mae'
    loss: 'huber'  
  ridge_model: {}


single_model: &single_model !Stage
  name: single_model
  params:
    needs_dvc: false
    model_params:
      <<: *default_params
    experiment:
      train_size: 0.3
  outputs:
    - !path
      path: "./results/single_model"
  script:
    - >
        python ./src/main.py single-model \
               --model_params "${json(self.params.model_params)}" \
               --params "${json(self.params.experiment)}" \
               --folder "${self.outputs[0].path}"

hidden_loops: &hidden_loops !Stage
  name: hidden_loops
  params:
    needs_dvc: false
    model_params:
      <<: *default_params
    experiment:
      adherence: 0.2
      usage: 1.0
      step: 10
  outputs:
    - !path
      path: "./results/hidden_loops"
  script:
    - >
      python ./src/main.py hidden-loop \
                     --model_params "${json(self.params.model_params)}" \
                     --params "${json(self.params.experiment)}" \
                     --folder "${self.outputs[0].path}"

pipeline: !GenericPipeline
  runs:
    - *single_model
    - *hidden_loops
